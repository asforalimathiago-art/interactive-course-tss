const apiBase="";const $=s=>document.querySelector(s);const st={};async function nextQ(){const sid=$('#sessionId').value.trim()||'demo-1';st.sid=sid;const r=await fetch(`${apiBase}/questionnaire/next`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({session_id:sid,context:{role:'support'}})});const d=await r.json();const q=d.question||d;st.q=q;$('#qStem').textContent=q.stem;const list=$('#choices');list.innerHTML='';(q.choices||[]).forEach((c,i)=>{const li=document.createElement('li');li.textContent=c;li.onclick=()=>{st.sel=i;document.querySelectorAll('#choices li').forEach(n=>n.classList.remove('selected'));li.classList.add('selected');$('#submitBtn').disabled=false;};list.appendChild(li);});$('#qSection').classList.remove('hidden');$('#feedback').classList.add('hidden');}async function submitA(){const r=await fetch(`${apiBase}/questionnaire/submit`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({session_id:st.sid,question_id:st.q.id,selected:String(st.sel)})});const d=await r.json();$('#feedback').classList.remove('hidden');$('#feedback').innerHTML=`<h3>${d.correct?'✅ Correct':'❌ Not quite'}</h3><p>Score: ${d.score}</p><p>${(d.feedback&&d.feedback.long)||''}</p><p class='muted'>${d.rationale||''}</p>`;}async function tssCreate(){const r=await fetch(`${apiBase}/tss/event`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({org_id:'demo',event_type:'support_trace',payload:{example:'hello',count:1}})});const d=await r.json();st.tss=d;$('#tssOutput').textContent=JSON.stringify(d,null,2);}async function tssRecon(){if(!st.tss)return;const pid=st.tss.payload_id;const shares=st.tss.shares_demo;const provided={user:shares.user,operator:shares.operator};const r=await fetch(`${apiBase}/tss/reconstruct`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({payload_id:pid,provided_roles:provided,reason:'demo'})});const d=await r.json();$('#tssReconOut').textContent=JSON.stringify(d,null,2);}function resetAll(){$('#qSection').classList.add('hidden');$('#feedback').classList.add('hidden');}window.addEventListener('DOMContentLoaded',()=>{$('#startBtn').onclick=nextQ;$('#submitBtn').onclick=submitA;$('#resetBtn').onclick=resetAll;$('#tssCreate').onclick=tssCreate;$('#tssRecon').onclick=tssRecon;});